<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¬ë„ì±…ë°© - ë³¸ì‚¬ ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700&family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--grape-900:#1a0a2e;--grape-800:#2d1b4e;--grape-700:#4a2c7a;--grape-600:#5e3d8c;--grape-500:#7c4dff;--grape-400:#9d7ae8;--grape-300:#b794f4;--grape-100:#e9d8fd;--grape-50:#f5f0ff;--gold:#d4af37;--text-dark:#2d2d2d;--text-light:#666;--success:#10b981;--warning:#f59e0b;--danger:#ef4444}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Pretendard',sans-serif;background:#f5f7fa;display:flex;min-height:100vh}
        .sidebar{width:260px;background:linear-gradient(180deg,var(--grape-900),var(--grape-800));padding:1.5rem;position:fixed;top:0;left:0;bottom:0;overflow-y:auto}
        .sidebar-logo{display:flex;align-items:center;gap:0.6rem;padding-bottom:1.25rem;border-bottom:1px solid rgba(255,255,255,0.1);margin-bottom:1.25rem}
        .sidebar-logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--grape-500),var(--gold));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}
        .sidebar-logo-text{color:white;font-family:'Noto Serif KR',serif;font-weight:700;font-size:1.1rem}
        .sidebar-user{padding:0.85rem;background:rgba(255,255,255,0.05);border-radius:10px;margin-bottom:1.25rem}
        .sidebar-user-name{color:white;font-weight:600;font-size:0.95rem}
        .sidebar-user-role{color:var(--grape-300);font-size:0.8rem}
        .sidebar-nav{display:flex;flex-direction:column;gap:0.3rem}
        .sidebar-section{margin-top:1.25rem;padding-top:1.25rem;border-top:1px solid rgba(255,255,255,0.1)}
        .sidebar-section-title{color:var(--grape-400);font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:0.6rem;padding-left:0.6rem}
        .sidebar-item{display:flex;align-items:center;gap:0.6rem;padding:0.75rem 0.85rem;color:rgba(255,255,255,0.7);border-radius:8px;cursor:pointer;font-size:0.9rem;transition:all 0.2s}
        .sidebar-item:hover{background:rgba(255,255,255,0.1);color:white}
        .sidebar-item.active{background:linear-gradient(135deg,var(--grape-500),var(--grape-600));color:white}
        .main{flex:1;margin-left:260px;padding:1.5rem 2rem}
        .main-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}
        .main-title{font-family:'Noto Serif KR',serif;font-size:1.5rem;font-weight:700;color:var(--grape-900)}
        .main-actions{display:flex;gap:0.75rem;align-items:center}
        .search-box{display:flex;align-items:center;background:white;border-radius:8px;padding:0.4rem 0.8rem;border:1px solid #e0e0e0}
        .search-box input{border:none;outline:none;width:180px;padding:0.4rem;font-size:0.9rem}
        .notif-btn{width:40px;height:40px;background:white;border:1px solid #e0e0e0;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;font-size:1.1rem}
        .notif-badge{position:absolute;top:-4px;right:-4px;width:18px;height:18px;background:var(--danger);color:white;border-radius:50%;font-size:0.65rem;display:flex;align-items:center;justify-content:center}
        .quick-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}
        .quick-card{background:white;border-radius:14px;padding:1.25rem;text-align:center;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
        .quick-card:hover{border-color:var(--grape-300);transform:translateY(-2px);box-shadow:0 8px 20px rgba(124,77,255,0.1)}
        .quick-icon{width:45px;height:45px;margin:0 auto 0.75rem;background:linear-gradient(135deg,var(--grape-100),var(--grape-300));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.3rem}
        .quick-title{font-weight:600;color:var(--grape-900);font-size:0.9rem}
        .quick-desc{font-size:0.75rem;color:var(--text-light)}
        .stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}
        .stat-card{background:white;border-radius:14px;padding:1.25rem;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
        .stat-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:0.75rem}
        .stat-card-title{font-size:0.8rem;color:var(--text-light);font-weight:500}
        .stat-card-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
        .stat-card-value{font-size:1.75rem;font-weight:700;color:var(--grape-900)}
        .stat-card-change{font-size:0.8rem;margin-top:0.25rem}
        .stat-card-change.up{color:var(--success)}
        .card{background:white;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,0.04);overflow:hidden;margin-bottom:1.5rem}
        .card-header{padding:1.25rem;border-bottom:1px solid #f0f0f0;display:flex;justify-content:space-between;align-items:center}
        .card-title{font-weight:700;color:var(--grape-900)}
        .card-body{padding:1.25rem}
        .data-table{width:100%;border-collapse:collapse}
        .data-table th,.data-table td{padding:0.85rem 1rem;text-align:left;border-bottom:1px solid #f0f0f0;font-size:0.9rem}
        .data-table th{background:#fafafa;font-weight:600;color:var(--text-light);font-size:0.8rem}
        .data-table tbody tr:hover{background:var(--grape-50)}
        .badge{padding:0.25rem 0.6rem;border-radius:50px;font-size:0.75rem;font-weight:600}
        .badge-success{background:#d1fae5;color:#065f46}
        .badge-warning{background:#fef3c7;color:#92400e}
        .grid-2{display:grid;grid-template-columns:2fr 1fr;gap:1.5rem}
        .branch-bar{margin-bottom:1rem}
        .branch-bar-header{display:flex;justify-content:space-between;margin-bottom:0.4rem}
        .branch-bar-name{font-weight:600;font-size:0.9rem}
        .branch-bar-val{color:var(--grape-600);font-size:0.9rem}
        .branch-bar-track{background:var(--grape-100);border-radius:6px;height:8px;overflow:hidden}
        .branch-bar-fill{height:100%;border-radius:6px;background:linear-gradient(90deg,var(--grape-500),var(--grape-600))}
        .btn{padding:0.5rem 1rem;border-radius:8px;font-weight:600;font-size:0.85rem;cursor:pointer;border:none}
        .btn-primary{background:linear-gradient(135deg,var(--grape-600),var(--grape-700));color:white}
        .btn-secondary{background:white;color:var(--grape-700);border:1px solid var(--grape-300)}
        .btn-success{background:linear-gradient(135deg,var(--success),#059669);color:white}
        .btn-gold{background:linear-gradient(135deg,var(--gold),#f4e4a6);color:var(--grape-900)}
        .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:200;align-items:center;justify-content:center}
        .modal-overlay.active{display:flex}
        .modal{background:white;border-radius:16px;width:90%;max-width:550px;max-height:90vh;overflow-y:auto;animation:modalIn 0.25s ease-out}
        @keyframes modalIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
        .modal-header{padding:1.25rem;border-bottom:1px solid #f0f0f0;display:flex;justify-content:space-between;align-items:center}
        .modal-title{font-family:'Noto Serif KR',serif;font-size:1.2rem;font-weight:700;color:var(--grape-900)}
        .modal-close{width:32px;height:32px;border-radius:50%;border:none;background:#f0f0f0;cursor:pointer;font-size:1.1rem}
        .modal-body{padding:1.25rem}
        .modal-footer{padding:1.25rem;border-top:1px solid #f0f0f0;display:flex;justify-content:flex-end;gap:0.6rem}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}
        .form-group{margin-bottom:1rem}
        .form-label{display:block;font-weight:600;color:var(--grape-800);margin-bottom:0.4rem;font-size:0.85rem}
        .form-input,.form-select{width:100%;padding:0.75rem 1rem;border:2px solid var(--grape-100);border-radius:10px;font-size:0.95rem;background:var(--grape-50)}
        .form-input:focus,.form-select:focus{outline:none;border-color:var(--grape-500);background:white}
        .scanner{background:#1a1a2e;border-radius:12px;padding:1.5rem;text-align:center;color:white;margin-bottom:1.25rem}
        .scanner-view{width:100%;height:120px;background:#16213e;border-radius:8px;margin-bottom:0.75rem;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
        .scanner-line{position:absolute;width:80%;height:2px;background:var(--success);box-shadow:0 0 8px var(--success);animation:scanAnim 2s ease-in-out infinite}
        @keyframes scanAnim{0%,100%{top:15%}50%{top:85%}}
        .scanner-input{width:100%;padding:0.85rem;background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.2);border-radius:8px;color:white;font-size:1.1rem;text-align:center}
        .scanner-input::placeholder{color:rgba(255,255,255,0.4)}
        .toast{position:fixed;top:1.5rem;right:1.5rem;padding:1rem 1.5rem;background:white;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,0.15);display:none;z-index:300;align-items:center;gap:0.5rem}
        .toast.show{display:flex}
        .toast.success{border-left:4px solid var(--success)}
        .toast.error{border-left:4px solid var(--danger)}
        @media(max-width:1100px){.stat-grid,.quick-grid{grid-template-columns:repeat(2,1fr)}.grid-2{grid-template-columns:1fr}}
        @media(max-width:900px){.sidebar{width:70px;padding:1rem 0.5rem}.sidebar-logo-text,.sidebar-section-title,.sidebar-item span:last-child,.sidebar-user-name,.sidebar-user-role{display:none}.sidebar-logo,.sidebar-item{justify-content:center}.main{margin-left:70px}}
    </style>
</head>
<body>
    <div class="toast" id="toast"></div>
    <aside class="sidebar">
        <div class="sidebar-logo"><div class="sidebar-logo-icon">ğŸ‡</div><span class="sidebar-logo-text">í¬ë„ì±…ë°©</span></div>
        <div class="sidebar-user"><div class="sidebar-user-name" id="userName">ê´€ë¦¬ì</div><div class="sidebar-user-role">ë³¸ì‚¬ / ì „ì²´ ê¶Œí•œ</div></div>
        <nav class="sidebar-nav">
            <div class="sidebar-item active" data-section="overview"><span>ğŸ“Š</span><span>ëŒ€ì‹œë³´ë“œ</span></div>
            <div class="sidebar-item" data-section="branches"><span>ğŸª</span><span>ì§€ì  ê´€ë¦¬</span></div>
            <div class="sidebar-item" data-section="owners"><span>ğŸ‘¥</span><span>ì ì£¼ ê´€ë¦¬</span></div>
            <div class="sidebar-item" data-section="books"><span>ğŸ“š</span><span>ë„ì„œ ê´€ë¦¬</span></div>
            <div class="sidebar-item" data-section="goods"><span>ğŸ</span><span>êµ¿ì¦ˆ ê´€ë¦¬</span></div>
            <div class="sidebar-item" data-section="sales"><span>ğŸ’°</span><span>ë§¤ì¶œ ê´€ë¦¬</span></div>
            <div class="sidebar-item" data-section="settlements"><span>ğŸ§¾</span><span>ì •ì‚° ê´€ë¦¬</span></div>
            <div class="sidebar-section">
                <div class="sidebar-section-title">ì‹œìŠ¤í…œ</div>
                <div class="sidebar-item" data-section="shelves"><span>ğŸ“¦</span><span>ì„œê°€ ê´€ë¦¬</span></div>
                <div class="sidebar-item" data-section="settings"><span>âš™ï¸</span><span>ì„¤ì •</span></div>
            </div>
        </nav>
        <div style="margin-top:auto;padding-top:1rem"><div class="sidebar-item" onclick="doLogout()"><span>ğŸšª</span><span>ë¡œê·¸ì•„ì›ƒ</span></div></div>
    </aside>
    <main class="main" id="mainContent"></main>

    <!-- Notification Modal -->
    <div class="modal-overlay" id="notifModal">
        <div class="modal" style="max-width:450px">
            <div class="modal-header"><h3 class="modal-title">ğŸ”” ì•Œë¦¼</h3><button class="modal-close" onclick="closeModal('notifModal')">Ã—</button></div>
            <div class="modal-body" id="notifList" style="max-height:400px;overflow-y:auto"></div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="markAllNotifRead()">ëª¨ë‘ ì½ìŒ</button></div>
        </div>
    </div>

    <!-- Add Book Modal -->
    <div class="modal-overlay" id="addBookModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">ğŸ“– ë„ì„œ ë“±ë¡</h3><button class="modal-close" onclick="closeModal('addBookModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="scanner">
                    <div class="scanner-view">
                        <video id="scannerVideo" style="width:100%;height:100%;object-fit:cover;display:none"></video>
                        <canvas id="scannerCanvas" style="display:none"></canvas>
                        <div class="scanner-line"></div>
                        <span id="scannerPlaceholder" style="opacity:0.5">ISBN ë°”ì½”ë“œ ìŠ¤ìº”</span>
                    </div>
                    <div style="display:flex;gap:0.5rem;margin-bottom:0.75rem">
                        <button onclick="startScanner('bookIsbn')" style="flex:1;padding:0.5rem;background:var(--success);color:white;border:none;border-radius:6px;cursor:pointer">ğŸ“· ì¹´ë©”ë¼ ìŠ¤ìº”</button>
                        <button onclick="stopBarcodeScanner()" style="padding:0.5rem;background:#666;color:white;border:none;border-radius:6px;cursor:pointer">ì¤‘ì§€</button>
                    </div>
                    <input type="text" class="scanner-input" id="bookIsbn" placeholder="ISBN ì…ë ¥ ë˜ëŠ” ìŠ¤ìº”">
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ë„ì„œëª… *</label><input type="text" class="form-input" id="bookTitle"></div>
                    <div class="form-group"><label class="form-label">ì €ì *</label><input type="text" class="form-input" id="bookAuthor"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì¶œíŒì‚¬</label><input type="text" class="form-input" id="bookPublisher"></div>
                    <div class="form-group"><label class="form-label">íŒë§¤ê°€ *</label><input type="number" class="form-input" id="bookPrice"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ìƒíƒœ (ì •ì‚° ë°°ë¶„ìœ¨)</label><select class="form-select" id="bookCondition"><option value="order_new">ì£¼ë¬¸ìƒˆì±… (ì±…ë°© 0% / ì ì£¼ 100%)</option><option value="owner_new">ì ì£¼ìƒˆì±… (ì±…ë°© 15% / ì ì£¼ 85%)</option><option value="used" selected>í—Œì±… (ì±…ë°© 50% / ì ì£¼ 50%)</option></select></div>
                    <div class="form-group"><label class="form-label">ì„œê°€/ì ì£¼ *</label><select class="form-select" id="bookOwner"></select></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('addBookModal')">ì·¨ì†Œ</button><button class="btn btn-success" onclick="saveBook(true)">ë“±ë¡ + QRì¶œë ¥</button><button class="btn btn-primary" onclick="saveBook(false)">ë“±ë¡ë§Œ</button></div>
        </div>
    </div>

    <!-- Sale Modal -->
    <div class="modal-overlay" id="saleModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">ğŸ’³ íŒë§¤ ì²˜ë¦¬</h3><button class="modal-close" onclick="closeModal('saleModal');clearCart()">Ã—</button></div>
            <div class="modal-body">
                <div class="scanner">
                    <div class="scanner-view">
                        <video id="saleVideo" style="width:100%;height:100%;object-fit:cover;display:none"></video>
                        <div class="scanner-line"></div>
                        <span style="opacity:0.5">ë„ì„œ ë°”ì½”ë“œ ìŠ¤ìº”</span>
                    </div>
                    <div style="display:flex;gap:0.5rem;margin-bottom:0.75rem">
                        <button onclick="startScanner('saleIsbn', addToCart)" style="flex:1;padding:0.5rem;background:var(--success);color:white;border:none;border-radius:6px;cursor:pointer">ğŸ“· ì¹´ë©”ë¼ ìŠ¤ìº”</button>
                        <button onclick="stopBarcodeScanner()" style="padding:0.5rem;background:#666;color:white;border:none;border-radius:6px;cursor:pointer">ì¤‘ì§€</button>
                    </div>
                    <input type="text" class="scanner-input" id="saleIsbn" placeholder="ISBN ë˜ëŠ” ë„ì„œID" onkeypress="if(event.key==='Enter')addToCart()">
                </div>
                <div id="cartItems" style="margin-bottom:1rem;max-height:150px;overflow-y:auto"></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ê²°ì œìˆ˜ë‹¨</label><select class="form-select" id="payMethod"><option value="card">ì¹´ë“œ</option><option value="cash">í˜„ê¸ˆ</option></select></div>
                    <div class="form-group"><label class="form-label">ì´ ê¸ˆì•¡</label><input type="text" class="form-input" id="cartTotal" value="â‚©0" readonly style="font-weight:700;font-size:1.2rem;text-align:right"></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('saleModal');clearCart()">ì·¨ì†Œ</button><button class="btn btn-success" onclick="completeSale()">ê²°ì œ ì™„ë£Œ</button></div>
        </div>
    </div>

    <!-- Add Owner Modal -->
    <div class="modal-overlay" id="addOwnerModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">ğŸ‘¤ ì ì£¼ ë“±ë¡</h3><button class="modal-close" onclick="closeModal('addOwnerModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì´ë¦„ *</label><input type="text" class="form-input" id="ownerName"></div>
                    <div class="form-group"><label class="form-label">ì—°ë½ì²˜ *</label><input type="tel" class="form-input" id="ownerPhone" placeholder="010-0000-0000"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì´ë©”ì¼</label><input type="email" class="form-input" id="ownerEmail"></div>
                    <div class="form-group"><label class="form-label">ì§€ì  *</label><select class="form-select" id="ownerBranch"></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì„œê°€ ë°°ì •</label><input type="text" class="form-input" id="ownerShelves" placeholder="A-01, A-02"></div>
                    <div class="form-group"><label class="form-label">ë¹„ë°€ë²ˆí˜¸ *</label><input type="password" class="form-input" id="ownerPassword" value="1234"></div>
                </div>
                <div class="form-group"><label class="form-label">ì •ì‚°ê³„ì¢Œ *</label><input type="text" class="form-input" id="ownerBank" placeholder="ì€í–‰ëª… ê³„ì¢Œë²ˆí˜¸"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('addOwnerModal')">ì·¨ì†Œ</button><button class="btn btn-primary" onclick="saveOwner()">ë“±ë¡</button></div>
        </div>
    </div>

    <!-- Add Branch Modal -->
    <div class="modal-overlay" id="addBranchModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">ğŸª ì§€ì  ì¶”ê°€</h3><button class="modal-close" onclick="closeModal('addBranchModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">ì§€ì ëª… *</label><input type="text" class="form-input" id="branchNameInput" placeholder="ì˜ˆ: ì„œìš¸ì "></div>
                <div class="form-group"><label class="form-label">ì£¼ì†Œ *</label><input type="text" class="form-input" id="branchAddress" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬..."></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì„œê°€ ìˆ˜</label><input type="number" class="form-input" id="branchShelfCount" value="100"></div>
                    <div class="form-group"><label class="form-label">ìƒíƒœ</label><select class="form-select" id="branchStatus"><option value="active">ìš´ì˜ì¤‘</option><option value="pending">ì¤€ë¹„ì¤‘</option></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì•„ì´ì½˜</label><input type="text" class="form-input" id="branchIcon" value="ğŸª" style="font-size:1.5rem"></div>
                    <div class="form-group"><label class="form-label">í…Œë§ˆìƒ‰ìƒ</label><input type="color" class="form-input" id="branchColor" value="#7c4dff" style="height:46px;padding:5px"></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('addBranchModal')">ì·¨ì†Œ</button><button class="btn btn-primary" onclick="saveBranch()">ë“±ë¡</button></div>
        </div>
    </div>

    <!-- Owner Detail Modal -->
    <div class="modal-overlay" id="ownerDetailModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">ğŸ‘¤ ì ì£¼ ìƒì„¸</h3><button class="modal-close" onclick="closeModal('ownerDetailModal')">Ã—</button></div>
            <div class="modal-body" id="ownerDetailBody"></div>
            <div class="modal-footer">
                <button class="btn btn-danger" style="margin-right:auto" onclick="deleteOwner()">ì‚­ì œ</button>
                <button class="btn btn-secondary" onclick="closeModal('ownerDetailModal')">ë‹«ê¸°</button>
                <button class="btn btn-primary" onclick="updateOwner()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Add Goods Modal -->
    <div class="modal-overlay" id="addGoodsModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">ğŸ êµ¿ì¦ˆ ë“±ë¡</h3><button class="modal-close" onclick="closeModal('addGoodsModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">ìƒí’ˆëª… *</label><input type="text" class="form-input" id="goodsName"></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">íŒë§¤ê°€ *</label><input type="number" class="form-input" id="goodsPrice"></div>
                    <div class="form-group"><label class="form-label">ìˆ˜ëŸ‰ *</label><input type="number" class="form-input" id="goodsQty" value="1"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ìƒíƒœ (ì •ì‚° ë°°ë¶„ìœ¨)</label><select class="form-select" id="goodsStatus">
                        <option value="podo">í¬ë„ (ì±…ë°© 100% / ì ì£¼ 0%)</option>
                        <option value="collab">í˜‘ë ¥ (ì±…ë°© 30% / ì ì£¼ 70%)</option>
                        <option value="handmade" selected>ìì‘ (ì±…ë°© 20% / ì ì£¼ 80%)</option>
                        <option value="consign">ìœ„íƒ (ì±…ë°© 20% / ì ì£¼ 80%)</option>
                    </select></div>
                    <div class="form-group"><label class="form-label">ì§€ì  *</label><select class="form-select" id="goodsBranch"></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì ì£¼ (í¬ë„ ì œì™¸)</label><select class="form-select" id="goodsOwner"><option value="">í¬ë„ì±…ë°© ìì²´</option></select></div>
                    <div class="form-group"><label class="form-label">ì„œê°€</label><input type="text" class="form-input" id="goodsShelf" placeholder="ì˜ˆ: S01"></div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('addGoodsModal')">ì·¨ì†Œ</button><button class="btn btn-success" onclick="saveGoods(true)">ë“±ë¡ + QRì¶œë ¥</button><button class="btn btn-primary" onclick="saveGoods(false)">ë“±ë¡ë§Œ</button></div>
        </div>
    </div>

    <!-- Settlement Modal -->
    <div class="modal-overlay" id="settlementModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title">ğŸ§¾ ì •ì‚° ì‹¤í–‰</h3><button class="modal-close" onclick="closeModal('settlementModal')">Ã—</button></div>
            <div class="modal-body">
                <div style="background:var(--grape-50);border-radius:12px;padding:1.5rem;text-align:center;margin-bottom:1rem">
                    <h4 style="color:var(--grape-800);margin-bottom:0.75rem" id="settlePeriod">2025ë…„ 1ì›” ì •ì‚°</h4>
                    <div style="font-size:2rem;font-weight:700;color:var(--grape-700)" id="settleTotal">â‚©0</div>
                    <p style="color:var(--text-light);margin-top:0.5rem" id="settleCount">0ëª… ì •ì‚° ëŒ€ìƒ</p>
                </div>
                <div style="background:#fef3c7;border-radius:8px;padding:0.85rem;display:flex;gap:0.6rem;align-items:center">
                    <span>âš ï¸</span><span style="font-size:0.85rem;color:#92400e">ì •ì‚° ì‹¤í–‰ ì „ íŒë§¤ ë‚´ì—­ì„ ìµœì¢… í™•ì¸í•´ì£¼ì„¸ìš”.</span>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('settlementModal')">ì·¨ì†Œ</button><button class="btn btn-gold" onclick="executeSettlement()">ì •ì‚° ì‹¤í–‰</button></div>
        </div>
    </div>

    <script src="podo-db.js"></script>
    <script>
        let cart = [];
        let currentSection = 'overview';

        document.addEventListener('DOMContentLoaded', () => {
            const session = PodoSession.get();
            if (!session || session.type !== 'admin') { location.href = 'login-admin.html'; return; }
            document.getElementById('userName').textContent = session.user.name || 'ê´€ë¦¬ì';
            renderSection('overview');
            setupNav();
        });

        function setupNav() {
            document.querySelectorAll('.sidebar-item[data-section]').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    renderSection(this.dataset.section);
                });
            });
        }

        function renderSection(section) {
            currentSection = section;
            const main = document.getElementById('mainContent');
            const stats = calcStats();
            const sales = PodoDB.get('sales') || [];
            const books = PodoDB.get('books') || [];
            const owners = PodoDB.get('owners') || [];
            const branches = PodoDB.get('branches') || [];

            if (section === 'overview') {
                main.innerHTML = `
                    <div class="main-header"><h1 class="main-title">ëŒ€ì‹œë³´ë“œ</h1><div class="main-actions"><div class="search-box"><span>ğŸ”</span><input type="text" placeholder="ê²€ìƒ‰..."></div><button class="notif-btn" onclick="openNotifModal()">ğŸ””<span class="notif-badge" id="notifCount">0</span></button></div></div>
                    <div class="quick-grid">
                        <div class="quick-card" onclick="openAddBookModal()"><div class="quick-icon">ğŸ“–</div><div class="quick-title">ë„ì„œ ë“±ë¡</div><div class="quick-desc">ë°”ì½”ë“œ ìŠ¤ìº”</div></div>
                        <div class="quick-card" onclick="openModal('saleModal')"><div class="quick-icon">ğŸ’³</div><div class="quick-title">íŒë§¤ ì²˜ë¦¬</div><div class="quick-desc">ê²°ì œ ì…ë ¥</div></div>
                        <div class="quick-card" onclick="openAddOwnerModal()"><div class="quick-icon">ğŸ‘¤</div><div class="quick-title">ì ì£¼ ë“±ë¡</div><div class="quick-desc">ì‹ ê·œ ê°€ì…</div></div>
                        <div class="quick-card" onclick="openSettlementModal()"><div class="quick-icon">ğŸ§¾</div><div class="quick-title">ì •ì‚° ì‹¤í–‰</div><div class="quick-desc">ì›”ê°„ ì •ì‚°</div></div>
                    </div>
                    <div class="stat-grid">
                        <div class="stat-card"><div class="stat-card-header"><span class="stat-card-title">ì´ ë§¤ì¶œ</span><div class="stat-card-icon" style="background:#d1fae5;color:#065f46">ğŸ’°</div></div><div class="stat-card-value">${formatMoney(stats.totalSales)}</div><div class="stat-card-change up">â†‘ 12.5%</div></div>
                        <div class="stat-card"><div class="stat-card-header"><span class="stat-card-title">íŒë§¤ ë„ì„œ</span><div class="stat-card-icon" style="background:#dbeafe;color:#1e40af">ğŸ“š</div></div><div class="stat-card-value">${stats.salesCount}ê¶Œ</div><div class="stat-card-change up">â†‘ 8.3%</div></div>
                        <div class="stat-card"><div class="stat-card-header"><span class="stat-card-title">í™œì„± ì ì£¼</span><div class="stat-card-icon" style="background:#fef3c7;color:#92400e">ğŸ‘¥</div></div><div class="stat-card-value">${stats.ownerCount}ëª…</div><div class="stat-card-change up">â†‘ 5ëª…</div></div>
                        <div class="stat-card"><div class="stat-card-header"><span class="stat-card-title">ì •ì‚° ì˜ˆì •</span><div class="stat-card-icon" style="background:#e9d8fd;color:#5b21b6">ğŸ§¾</div></div><div class="stat-card-value">${formatMoney(stats.settlementAmount)}</div><div class="stat-card-change">2ì›” 10ì¼</div></div>
                    </div>
                    <div class="grid-2">
                        <div class="card"><div class="card-header"><span class="card-title">ìµœê·¼ íŒë§¤</span><button class="btn btn-secondary" onclick="renderSection('sales')">ì „ì²´ë³´ê¸°</button></div>
                            <table class="data-table"><thead><tr><th>ì‹œê°„</th><th>ë„ì„œëª…</th><th>ì ì£¼</th><th>ì§€ì </th><th>ê¸ˆì•¡</th></tr></thead>
                            <tbody>${sales.slice(-5).reverse().map(s => {
                                const branch = branches.find(b=>b.id===s.branchId);
                                return `<tr><td>${s.date.split(' ')[1]||''}</td><td>${s.bookTitle||'-'}</td><td>${s.ownerName||'-'}</td><td>${branch?.name||'-'}</td><td>${formatMoney(s.price)}</td></tr>`;
                            }).join('')}</tbody></table>
                        </div>
                        <div class="card"><div class="card-header"><span class="card-title">ì§€ì ë³„ í˜„í™©</span></div><div class="card-body">
                            ${branches.filter(b=>b.status==='active').map(b => {
                                const branchSales = sales.filter(s=>s.branchId===b.id).reduce((sum,s)=>sum+s.price,0);
                                const pct = stats.totalSales > 0 ? Math.round(branchSales/stats.totalSales*100) : 0;
                                return `<div class="branch-bar"><div class="branch-bar-header"><span class="branch-bar-name">${b.name}</span><span class="branch-bar-val">${formatMoney(branchSales)}</span></div><div class="branch-bar-track"><div class="branch-bar-fill" style="width:${pct}%"></div></div></div>`;
                            }).join('')}
                        </div></div>
                    </div>
                    <div class="card"><div class="card-header"><span class="card-title">ğŸ“ˆ ì£¼ê°„ ë§¤ì¶œ ì¶”ì´</span></div><div class="card-body"><canvas id="salesChart" height="80"></canvas></div></div>`;
                // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
                setTimeout(() => drawSalesChart(), 100);
                // ì•Œë¦¼ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                updateNotifCount();
            } else if (section === 'branches') {
                main.innerHTML = `
                    <div class="main-header"><h1 class="main-title">ì§€ì  ê´€ë¦¬</h1><span style="font-size:0.85rem;color:var(--text-light)">â€» ì§€ì  ì¶”ê°€ëŠ” ë³„ë„ ë¬¸ì˜</span></div>
                    <div class="stat-grid" style="grid-template-columns:repeat(3,1fr)">${branches.map(b => `
                        <div class="card"><div class="card-body">
                            <div style="display:flex;justify-content:space-between;align-items:start">
                                <div><h3 style="font-size:1.2rem;font-weight:700;color:var(--grape-900)">${b.name}</h3><p style="color:var(--text-light);font-size:0.85rem;margin:0.5rem 0">${b.address}</p><span class="badge ${b.status==='active'?'badge-success':'badge-warning'}">${b.status==='active'?'ìš´ì˜ì¤‘':'ì¤€ë¹„ì¤‘'}</span></div>
                                <div style="width:50px;height:50px;border-radius:12px;background:linear-gradient(135deg,${b.color},${b.color}cc);display:flex;align-items:center;justify-content:center;font-size:1.5rem">${b.icon}</div>
                            </div>
                            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-top:1.5rem;padding-top:1rem;border-top:1px solid #f0f0f0">
                                <div><div style="font-weight:700;color:var(--grape-700)">${b.shelfCount}</div><div style="font-size:0.75rem;color:var(--text-light)">ì„œê°€</div></div>
                                <div><div style="font-weight:700;color:var(--grape-700)">${owners.filter(o=>o.branchId===b.id&&o.status==='active').length}</div><div style="font-size:0.75rem;color:var(--text-light)">ì ì£¼</div></div>
                                <div><div style="font-weight:700;color:var(--grape-700)">${books.filter(bk=>bk.branchId===b.id).length}</div><div style="font-size:0.75rem;color:var(--text-light)">ë„ì„œ</div></div>
                            </div>
                        </div></div>
                    `).join('')}</div>`;
            } else if (section === 'owners') {
                main.innerHTML = `
                    <div class="main-header"><h1 class="main-title">ì ì£¼ ê´€ë¦¬</h1><button class="btn btn-primary" onclick="openAddOwnerModal()">+ ì ì£¼ ë“±ë¡</button></div>
                    <div class="card"><table class="data-table">
                        <thead><tr><th>ì´ë¦„</th><th>ì—°ë½ì²˜</th><th>ì§€ì </th><th>ì„œê°€</th><th>ë„ì„œìˆ˜</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
                        <tbody>${owners.map(o => {
                            const branch = branches.find(b=>b.id===o.branchId);
                            const bookCount = books.filter(b=>b.ownerId===o.id).length;
                            return `<tr><td><strong>${o.name}</strong></td><td>${o.phone}</td><td>${branch?.name||'-'}</td><td>${o.shelves?.join(', ')||'-'}</td><td>${bookCount}ê¶Œ</td><td><span class="badge ${o.status==='active'?'badge-success':'badge-warning'}">${o.status==='active'?'í™œì„±':'íœ´ë©´'}</span></td><td><button class="btn btn-secondary" onclick="openOwnerDetail('${o.id}')">ìƒì„¸</button></td></tr>`;
                        }).join('')}</tbody>
                    </table></div>`;
            } else if (section === 'books') {
                main.innerHTML = `
                    <div class="main-header"><h1 class="main-title">ë„ì„œ ê´€ë¦¬</h1><div style="display:flex;gap:0.5rem"><button class="btn btn-secondary" onclick="exportBooks()">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button><button class="btn btn-primary" onclick="openAddBookModal()">+ ë„ì„œ ë“±ë¡</button></div></div>
                    <div class="stat-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:1.5rem">
                        <div class="stat-card"><div class="stat-card-title">ì „ì²´ ë„ì„œ</div><div class="stat-card-value">${books.length}</div></div>
                        <div class="stat-card"><div class="stat-card-title">íŒë§¤ ê°€ëŠ¥</div><div class="stat-card-value" style="color:var(--success)">${books.filter(b=>b.status==='available').length}</div></div>
                        <div class="stat-card"><div class="stat-card-title">íŒë§¤ë¨</div><div class="stat-card-value" style="color:var(--warning)">${books.filter(b=>b.status==='sold').length}</div></div>
                        <div class="stat-card"><div class="stat-card-title">ì´ë²ˆë‹¬ ë“±ë¡</div><div class="stat-card-value" style="color:var(--grape-600)">+${books.filter(b=>b.createdAt?.startsWith(getTodayStr().slice(0,7))).length}</div></div>
                    </div>
                    <div class="card"><table class="data-table">
                        <thead><tr><th>ISBN</th><th>ë„ì„œëª…</th><th>ì €ì</th><th>ì ì£¼</th><th>ì„œê°€</th><th>ê°€ê²©</th><th>ìƒíƒœ</th><th>QR</th></tr></thead>
                        <tbody>${books.map(b => {
                            const owner = owners.find(o=>o.id===b.ownerId);
                            const statusName = BOOK_STATUS[b.status]?.name || b.status;
                            return `<tr><td style="font-family:monospace;font-size:0.8rem">${b.isbn||'-'}</td><td><strong>${b.title}</strong></td><td>${b.author}</td><td>${owner?.ownerNumber||'-'}</td><td>${b.shelf||'-'}</td><td>${formatMoney(b.price)}</td><td><span class="badge ${b.saleStatus==='available'?'badge-success':'badge-warning'}">${statusName}</span></td><td><button class="btn btn-secondary" onclick="printQRLabel({id:'${b.id}',title:'${b.title}',ownerNumber:'${b.ownerNumber||''}',price:${b.price}})">ğŸ·ï¸</button></td></tr>`;
                        }).join('')}</tbody>
                    </table></div>`;
            } else if (section === 'goods') {
                const goods = PodoDB.get('goods') || [];
                main.innerHTML = `
                    <div class="main-header"><h1 class="main-title">ğŸ êµ¿ì¦ˆ ê´€ë¦¬</h1><div style="display:flex;gap:0.5rem"><button class="btn btn-primary" onclick="openModal('addGoodsModal')">+ êµ¿ì¦ˆ ë“±ë¡</button></div></div>
                    <div class="stat-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:1.5rem">
                        <div class="stat-card"><div class="stat-card-title">í¬ë„(ìì²´)</div><div class="stat-card-value">${goods.filter(g=>g.status==='podo').length}ê°œ</div><div style="font-size:0.75rem;color:var(--text-light)">ì±…ë°© 100%</div></div>
                        <div class="stat-card"><div class="stat-card-title">í˜‘ë ¥</div><div class="stat-card-value">${goods.filter(g=>g.status==='collab').length}ê°œ</div><div style="font-size:0.75rem;color:var(--text-light)">ì±…ë°© 30% / ì ì£¼ 70%</div></div>
                        <div class="stat-card"><div class="stat-card-title">ìì‘</div><div class="stat-card-value">${goods.filter(g=>g.status==='handmade').length}ê°œ</div><div style="font-size:0.75rem;color:var(--text-light)">ì±…ë°© 20% / ì ì£¼ 80%</div></div>
                        <div class="stat-card"><div class="stat-card-title">ìœ„íƒ</div><div class="stat-card-value">${goods.filter(g=>g.status==='consign').length}ê°œ</div><div style="font-size:0.75rem;color:var(--text-light)">ì±…ë°© 20% / ì ì£¼ 80%</div></div>
                    </div>
                    <div class="card"><table class="data-table">
                        <thead><tr><th>ìƒí’ˆëª…</th><th>ìƒíƒœ</th><th>ê°€ê²©</th><th>ìˆ˜ëŸ‰</th><th>ì ì£¼</th><th>ì§€ì </th><th>QR</th></tr></thead>
                        <tbody>${goods.map(g => {
                            const owner = owners.find(o=>o.id===g.ownerId);
                            const branch = branches.find(br=>br.id===g.branchId);
                            const statusName = GOODS_STATUS[g.status]?.name || g.status;
                            return `<tr><td><strong>${g.name}</strong></td><td><span class="badge badge-success">${statusName}</span></td><td>${formatMoney(g.price)}</td><td>${g.qty}ê°œ</td><td>${g.ownerNumber||'í¬ë„ì±…ë°©'}</td><td>${branch?.name||'-'}</td><td><button class="btn btn-secondary" onclick="printQRLabel({id:'${g.id}',title:'${g.name}',ownerNumber:'${g.ownerNumber||''}',price:${g.price}})">ğŸ·ï¸</button></td></tr>`;
                        }).join('')}</tbody>
                    </table></div>`;
            } else if (section === 'sales') {
                const allSales = sales.slice().reverse();
                main.innerHTML = `
                    <div class="main-header"><h1 class="main-title">ë§¤ì¶œ ê´€ë¦¬</h1><div style="display:flex;gap:0.5rem"><button class="btn btn-secondary" onclick="exportSales()">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button><button class="btn btn-primary" onclick="openModal('saleModal')">+ íŒë§¤ ì…ë ¥</button></div></div>
                    <div class="card" style="padding:1rem;margin-bottom:1rem">
                        <div style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap">
                            <div><label style="font-size:0.85rem;color:var(--text-light)">ì‹œì‘ì¼</label><input type="date" id="adminSalesStart" class="form-input" style="width:auto;padding:0.5rem" onchange="filterAdminSales()"></div>
                            <div><label style="font-size:0.85rem;color:var(--text-light)">ì¢…ë£Œì¼</label><input type="date" id="adminSalesEnd" class="form-input" style="width:auto;padding:0.5rem" onchange="filterAdminSales()"></div>
                            <select id="adminSalesBranch" class="form-select" style="width:auto;padding:0.5rem" onchange="filterAdminSales()">
                                <option value="">ì „ì²´ ì§€ì </option>
                                ${branches.map(b=>`<option value="${b.id}">${b.name}</option>`).join('')}
                            </select>
                            <button class="btn btn-secondary" style="padding:0.5rem 1rem" onclick="resetAdminSalesFilter()">ì´ˆê¸°í™”</button>
                            <div style="margin-left:auto;font-weight:600" id="adminSalesSummary">ì´ ${allSales.length}ê±´ / ${formatMoney(allSales.reduce((s,x)=>s+x.price,0))}</div>
                        </div>
                    </div>
                    <div class="stat-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:1.5rem">
                        <div class="stat-card"><div class="stat-card-header"><span class="stat-card-title">ì´ ë§¤ì¶œ</span></div><div class="stat-card-value">${formatMoney(stats.totalSales)}</div></div>
                        <div class="stat-card"><div class="stat-card-header"><span class="stat-card-title">ì¹´ë“œ</span></div><div class="stat-card-value">${formatMoney(sales.filter(s=>s.method==='card').reduce((sum,s)=>sum+s.price,0))}</div></div>
                        <div class="stat-card"><div class="stat-card-header"><span class="stat-card-title">í˜„ê¸ˆ</span></div><div class="stat-card-value">${formatMoney(sales.filter(s=>s.method==='cash').reduce((sum,s)=>sum+s.price,0))}</div></div>
                        <div class="stat-card"><div class="stat-card-header"><span class="stat-card-title">ê±°ë˜ ê±´ìˆ˜</span></div><div class="stat-card-value">${sales.length}ê±´</div></div>
                    </div>
                    <div class="card"><div class="card-header"><span class="card-title">íŒë§¤ ë‚´ì—­</span></div><table class="data-table" id="adminSalesTable">
                        <thead><tr><th>íŒë§¤ID</th><th>ì¼ì‹œ</th><th>ìƒí’ˆëª…</th><th>ìƒíƒœ</th><th>ì ì£¼</th><th>ê¸ˆì•¡</th><th>ì±…ë°©</th><th>ì ì£¼ìˆ˜ìµ</th><th>ê²°ì œ</th><th>ì²˜ë¦¬</th></tr></thead>
                        <tbody>${allSales.map(s => {
                            const branch = branches.find(b=>b.id===s.branchId);
                            const isRefunded = s.saleStatus === 'refunded';
                            return `<tr data-date="${(s.createdAt||s.date||'').split(' ')[0]}" data-branch="${s.branchId||''}" style="${isRefunded?'opacity:0.5;text-decoration:line-through':''}"><td style="font-family:monospace;font-size:0.75rem">${s.id}</td><td style="font-size:0.8rem">${s.createdAt||s.date||''}</td><td><strong>${s.itemTitle||s.bookTitle||'-'}</strong></td><td style="font-size:0.75rem">${s.status||'-'}</td><td>${s.ownerNumber||s.ownerName||'-'}</td><td>${formatMoney(s.price)}</td><td style="color:var(--grape-600)">${formatMoney(s.shopAmount||0)}</td><td style="color:var(--success);font-weight:600">${formatMoney(s.ownerAmount||0)}</td><td>${s.method==='card'?'ì¹´ë“œ':s.method==='cash'?'í˜„ê¸ˆ':'ê³„ì¢Œ'}</td><td>${isRefunded?'<span class="badge badge-warning">ë°˜í’ˆ</span>':`<button class="btn btn-secondary" style="font-size:0.7rem;padding:0.25rem 0.5rem" onclick="refundSale('${s.id}')">ë°˜í’ˆ</button>`}</td></tr>`;
                        }).join('')}</tbody>
                    </table></div>`;
            } else if (section === 'settlements') {
                const settlements = PodoDB.get('settlements') || [];
                main.innerHTML = `
                    <div class="main-header"><h1 class="main-title">ì •ì‚° ê´€ë¦¬</h1><div style="display:flex;gap:0.5rem"><button class="btn btn-secondary" onclick="exportSettlements()">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button><button class="btn btn-gold" onclick="openSettlementModal()">ì •ì‚° ì‹¤í–‰</button></div></div>
                    <div class="stat-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:1.5rem">
                        <div class="stat-card"><div class="stat-card-title">ì •ì‚° ì˜ˆì •ì•¡</div><div class="stat-card-value">${formatMoney(stats.settlementAmount)}</div><div class="stat-card-change">2ì›” 10ì¼</div></div>
                        <div class="stat-card"><div class="stat-card-title">ìˆ˜ìˆ˜ë£Œ ìˆ˜ìµ</div><div class="stat-card-value">${formatMoney(stats.commission)}</div><div class="stat-card-change">10%</div></div>
                        <div class="stat-card"><div class="stat-card-title">ì •ì‚° ëŒ€ìƒ</div><div class="stat-card-value">${stats.ownerCount}ëª…</div></div>
                        <div class="stat-card"><div class="stat-card-title">ì™„ë£Œ ì •ì‚°</div><div class="stat-card-value">${settlements.filter(s=>s.status==='completed').length}ê±´</div></div>
                    </div>
                    <div class="card"><div class="card-header"><span class="card-title">ì •ì‚° ë‚´ì—­</span></div><table class="data-table">
                        <thead><tr><th>ì •ì‚°ID</th><th>ê¸°ê°„</th><th>ì ì£¼</th><th>íŒë§¤ì•¡</th><th>ìˆ˜ìˆ˜ë£Œ</th><th>ì„ëŒ€ë£Œ</th><th>ì •ì‚°ì•¡</th><th>ìƒíƒœ</th></tr></thead>
                        <tbody>${settlements.map(s => `<tr><td style="font-family:monospace;font-size:0.8rem">${s.id}</td><td>${s.period}</td><td>${s.ownerName}</td><td>${formatMoney(s.sales)}</td><td>-${formatMoney(s.commission)}</td><td>-${formatMoney(s.rent)}</td><td style="font-weight:700;color:var(--grape-700)">${formatMoney(s.amount)}</td><td><span class="badge badge-success">ì™„ë£Œ</span></td></tr>`).join('')}</tbody>
                    </table></div>`;
            } else if (section === 'shelves') {
                const shelves = PodoDB.get('shelves') || [];
                const branchShelves = {};
                branches.forEach(b => {
                    branchShelves[b.id] = { total: 0, used: 0, name: b.name };
                });
                shelves.forEach(s => {
                    if (branchShelves[s.branchId]) {
                        branchShelves[s.branchId].total++;
                        if (s.ownerId) branchShelves[s.branchId].used++;
                    }
                });
                main.innerHTML = `
                    <div class="main-header"><h1 class="main-title">ì„œê°€ ê´€ë¦¬</h1></div>
                    <div class="stat-grid" style="grid-template-columns:repeat(3,1fr);margin-bottom:1.5rem">
                        ${Object.entries(branchShelves).map(([id, data]) => `
                            <div class="stat-card">
                                <div class="stat-card-header"><span class="stat-card-title">${data.name}</span></div>
                                <div class="stat-card-value">${data.used}/${data.total}</div>
                                <div class="stat-card-change">ì‚¬ìš©ë¥  ${data.total > 0 ? Math.round(data.used/data.total*100) : 0}%</div>
                                <div style="margin-top:0.75rem;background:var(--grape-100);border-radius:6px;height:8px;overflow:hidden">
                                    <div style="height:100%;background:linear-gradient(90deg,var(--grape-500),var(--grape-600));width:${data.total > 0 ? Math.round(data.used/data.total*100) : 0}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="card"><div class="card-header"><span class="card-title">ì„œê°€ í˜„í™©</span></div>
                        <table class="data-table">
                            <thead><tr><th>ì„œê°€ì½”ë“œ</th><th>ì§€ì </th><th>íƒ€ì…</th><th>ì›”ì„ëŒ€ë£Œ</th><th>ì ì£¼</th><th>ìƒíƒœ</th></tr></thead>
                            <tbody>${shelves.slice(0, 50).map(s => {
                                const branch = branches.find(b => b.id === s.branchId);
                                const owner = owners.find(o => o.id === s.ownerId);
                                return `<tr><td><strong>${s.code}</strong></td><td>${branch?.name || '-'}</td><td>${s.type === 'small' ? 'ì†Œí˜•' : 'ì¤‘í˜•'}</td><td>${formatMoney(s.price)}</td><td>${owner?.name || '-'}</td><td><span class="badge ${s.ownerId ? 'badge-success' : 'badge-warning'}">${s.ownerId ? 'ì‚¬ìš©ì¤‘' : 'ê³µì‹¤'}</span></td></tr>`;
                            }).join('')}</tbody>
                        </table>
                        ${shelves.length > 50 ? '<p style="padding:1rem;text-align:center;color:var(--text-light)">ì™¸ ' + (shelves.length - 50) + 'ê°œ ì„œê°€...</p>' : ''}
                    </div>`;
            } else if (section === 'settings') {
                main.innerHTML = `
                    <div class="main-header"><h1 class="main-title">ì„¤ì •</h1></div>
                    <div class="card"><div class="card-header"><span class="card-title">ì‹œìŠ¤í…œ ì„¤ì •</span></div><div class="card-body">
                        <div class="form-group"><label class="form-label">ìˆ˜ìˆ˜ë£Œìœ¨ (%)</label><input type="number" class="form-input" value="10" style="max-width:200px"></div>
                        <div class="form-group"><label class="form-label">ì •ì‚°ì¼</label><input type="number" class="form-input" value="10" style="max-width:200px" placeholder="ë§¤ì›” Nì¼"></div>
                        <button class="btn btn-primary" onclick="showToast('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤','success')">ì €ì¥</button>
                    </div></div>
                    <div class="card"><div class="card-header"><span class="card-title">ë°ì´í„° ê´€ë¦¬</span></div><div class="card-body">
                        <p style="margin-bottom:1rem;color:var(--text-light)">ì£¼ì˜: ì´ˆê¸°í™”í•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.</p>
                        <button class="btn btn-danger" onclick="if(confirm('ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?')){localStorage.clear();location.reload()}">ë°ì´í„° ì´ˆê¸°í™”</button>
                    </div></div>`;
            } else {
                main.innerHTML = `<div class="main-header"><h1 class="main-title">${section}</h1></div><div class="card"><div class="card-body"><p>ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p></div></div>`;
            }
        }

        // Modal Functions
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function openAddBookModal() {
            const owners = PodoDB.get('owners') || [];
            document.getElementById('bookOwner').innerHTML = '<option value="">ì„ íƒ</option>' + owners.filter(o=>o.status==='active').map(o => `<option value="${o.id}">${o.name} (${o.shelves?.join(',')||'-'})</option>`).join('');
            openModal('addBookModal');
        }

        function openAddOwnerModal() {
            const branches = PodoDB.get('branches') || [];
            document.getElementById('ownerBranch').innerHTML = '<option value="">ì„ íƒ</option>' + branches.filter(b=>b.status==='active').map(b => `<option value="${b.id}">${b.name}</option>`).join('');
            openModal('addOwnerModal');
        }

        function openSettlementModal() {
            const stats = calcStats();
            const owners = PodoDB.get('owners') || [];
            const now = new Date();
            document.getElementById('settlePeriod').textContent = `${now.getFullYear()}ë…„ ${now.getMonth()+1}ì›” ì •ì‚°`;
            document.getElementById('settleTotal').textContent = formatMoney(stats.settlementAmount);
            document.getElementById('settleCount').textContent = `${owners.filter(o=>o.status==='active').length}ëª… ì •ì‚° ëŒ€ìƒ`;
            openModal('settlementModal');
        }

        function saveBook(printQR = false) {
            const books = PodoDB.get('books') || [];
            const owners = PodoDB.get('owners') || [];
            const ownerId = document.getElementById('bookOwner').value;
            const owner = owners.find(o => o.id === ownerId);
            if (!ownerId || !document.getElementById('bookTitle').value || !document.getElementById('bookPrice').value) {
                showToast('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return;
            }
            const newBook = {
                id: PodoDB.generateId('BK'),
                type: 'book',
                isbn: document.getElementById('bookIsbn').value || '',
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
                publisher: document.getElementById('bookPublisher').value,
                price: parseInt(document.getElementById('bookPrice').value),
                qty: 1,
                status: document.getElementById('bookCondition').value,
                shelf: owner?.shelves?.[0] || '',
                ownerId: ownerId,
                ownerNumber: owner?.ownerNumber || '',
                branchId: owner?.branchId || '',
                saleStatus: 'available',
                createdAt: getTodayStr()
            };
            books.push(newBook);
            PodoDB.set('books', books);
            closeModal('addBookModal');
            showToast('ë„ì„œê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
            // QR ì¶œë ¥
            if (printQR) {
                printQRLabel(newBook);
            }
            
            renderSection(currentSection);
            ['bookIsbn','bookTitle','bookAuthor','bookPublisher','bookPrice'].forEach(id => document.getElementById(id).value = '');
        }

        // êµ¿ì¦ˆ ë“±ë¡
        function saveGoods(printQR = false) {
            const goods = PodoDB.get('goods') || [];
            const owners = PodoDB.get('owners') || [];
            const name = document.getElementById('goodsName').value;
            const price = parseInt(document.getElementById('goodsPrice').value);
            const qty = parseInt(document.getElementById('goodsQty').value) || 1;
            const status = document.getElementById('goodsStatus').value;
            const branchId = document.getElementById('goodsBranch').value;
            const ownerId = document.getElementById('goodsOwner').value;
            const shelf = document.getElementById('goodsShelf').value;
            
            if (!name || !price || !branchId) {
                showToast('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return;
            }
            
            const owner = owners.find(o => o.id === ownerId);
            const newGoods = {
                id: PodoDB.generateId('GD'),
                type: 'goods',
                name: name,
                price: price,
                qty: qty,
                status: status,
                shelf: shelf,
                ownerId: ownerId || null,
                ownerNumber: owner?.ownerNumber || '',
                branchId: branchId,
                saleStatus: 'available',
                createdAt: getTodayStr()
            };
            goods.push(newGoods);
            PodoDB.set('goods', goods);
            closeModal('addGoodsModal');
            showToast('êµ¿ì¦ˆê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
            if (printQR) {
                printQRLabel({ ...newGoods, title: newGoods.name });
            }
            
            renderSection(currentSection);
            ['goodsName', 'goodsPrice', 'goodsShelf'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('goodsQty').value = '1';
        }

        // êµ¿ì¦ˆ ëª¨ë‹¬ ì—´ê¸°
        function openGoodsModal() {
            const branches = PodoDB.get('branches') || [];
            const owners = PodoDB.get('owners') || [];
            document.getElementById('goodsBranch').innerHTML = '<option value="">ì„ íƒ</option>' + branches.filter(b => b.status === 'active').map(b => `<option value="${b.id}">${b.name}</option>`).join('');
            document.getElementById('goodsOwner').innerHTML = '<option value="">í¬ë„ì±…ë°© ìì²´</option>' + owners.filter(o => o.status === 'active').map(o => `<option value="${o.id}">${o.ownerNumber} ${o.name}</option>`).join('');
            openModal('addGoodsModal');
        }

        function saveOwner() {
            const owners = PodoDB.get('owners') || [];
            if (!document.getElementById('ownerName').value || !document.getElementById('ownerPhone').value || !document.getElementById('ownerBranch').value) {
                showToast('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return;
            }
            const newOwner = {
                id: PodoDB.generateId('OW'),
                name: document.getElementById('ownerName').value,
                phone: document.getElementById('ownerPhone').value,
                email: document.getElementById('ownerEmail').value,
                branchId: document.getElementById('ownerBranch').value,
                shelves: document.getElementById('ownerShelves').value.split(',').map(s => s.trim()).filter(s => s),
                bank: document.getElementById('ownerBank').value,
                password: document.getElementById('ownerPassword').value || '1234',
                status: 'active',
                createdAt: getTodayStr()
            };
            owners.push(newOwner);
            PodoDB.set('owners', owners);
            closeModal('addOwnerModal');
            showToast('ì ì£¼ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            renderSection(currentSection);
        }

        // Cart & Sale
        function addToCart() {
            const input = document.getElementById('saleIsbn');
            const books = PodoDB.get('books') || [];
            const book = books.find(b => b.isbn === input.value || b.id === input.value);
            if (book && book.status === 'available') {
                cart.push(book);
                renderCart();
                input.value = '';
            } else {
                showToast('ë„ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
            }
        }

        function renderCart() {
            const owners = PodoDB.get('owners') || [];
            document.getElementById('cartItems').innerHTML = cart.map((b, i) => {
                const owner = owners.find(o => o.id === b.ownerId);
                return `<div style="display:flex;justify-content:space-between;align-items:center;padding:0.5rem;background:var(--grape-50);border-radius:8px;margin-bottom:0.5rem">
                    <div><strong>${b.title}</strong><br><small style="color:var(--text-light)">${owner?.name||'-'} Â· ${formatMoney(b.price)}</small></div>
                    <button onclick="cart.splice(${i},1);renderCart()" style="background:none;border:none;cursor:pointer;color:var(--danger)">âœ•</button>
                </div>`;
            }).join('');
            document.getElementById('cartTotal').value = formatMoney(cart.reduce((sum, b) => sum + b.price, 0));
        }

        function clearCart() { cart = []; renderCart(); }

        function completeSale() {
            if (cart.length === 0) { showToast('íŒë§¤í•  ë„ì„œë¥¼ ì¶”ê°€í•˜ì„¸ìš”', 'error'); return; }
            const sales = PodoDB.get('sales') || [];
            const books = PodoDB.get('books') || [];
            const owners = PodoDB.get('owners') || [];
            const branches = PodoDB.get('branches') || [];
            const method = document.getElementById('payMethod').value;
            
            cart.forEach(book => {
                const owner = owners.find(o => o.id === book.ownerId);
                const newSale = {
                    id: PodoDB.generateId('SL'),
                    bookId: book.id,
                    bookTitle: book.title,
                    ownerId: book.ownerId,
                    ownerName: owner?.name || '',
                    branchId: book.branchId,
                    price: book.price,
                    method: method,
                    date: getTodayStr() + ' ' + getTimeStr(),
                    status: 'completed'
                };
                sales.push(newSale);
                // Mark book as sold
                const bookIndex = books.findIndex(b => b.id === book.id);
                if (bookIndex >= 0) books[bookIndex].status = 'sold';
            });
            
            PodoDB.set('sales', sales);
            PodoDB.set('books', books);
            closeModal('saleModal');
            clearCart();
            showToast('íŒë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            renderSection(currentSection);
        }

        function executeSettlement() {
            const settlements = PodoDB.get('settlements') || [];
            const sales = PodoDB.get('sales') || [];
            const owners = PodoDB.get('owners') || [];
            const shelves = PodoDB.get('shelves') || [];
            const now = new Date();
            const period = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
            
            owners.filter(o => o.status === 'active').forEach(owner => {
                const ownerSales = sales.filter(s => s.ownerId === owner.id).reduce((sum, s) => sum + s.price, 0);
                const ownerShelves = shelves.filter(s => s.ownerId === owner.id);
                const rent = ownerShelves.reduce((sum, s) => sum + s.price, 0);
                const commission = Math.round(ownerSales * 0.1);
                
                settlements.push({
                    id: PodoDB.generateId('ST'),
                    period: period,
                    ownerId: owner.id,
                    ownerName: owner.name,
                    sales: ownerSales,
                    commission: commission,
                    rent: rent,
                    amount: ownerSales - commission - rent,
                    status: 'completed',
                    paidAt: getTodayStr()
                });
            });
            
            PodoDB.set('settlements', settlements);
            closeModal('settlementModal');
            showToast('ì •ì‚°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            renderSection('settlements');
        }

        function doLogout() {
            PodoSession.clear();
            showToast('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            setTimeout(() => location.href = 'index.html', 500);
        }

        // Branch functions
        function saveBranch() {
            const branches = PodoDB.get('branches') || [];
            const name = document.getElementById('branchNameInput').value;
            const address = document.getElementById('branchAddress').value;
            if (!name || !address) { showToast('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
            
            const newBranch = {
                id: PodoDB.generateId('BR'),
                name: name,
                address: address,
                icon: document.getElementById('branchIcon').value || 'ğŸª',
                color: document.getElementById('branchColor').value || '#7c4dff',
                shelfCount: parseInt(document.getElementById('branchShelfCount').value) || 100,
                status: document.getElementById('branchStatus').value
            };
            branches.push(newBranch);
            PodoDB.set('branches', branches);
            
            // Create shelves for new branch
            const shelves = PodoDB.get('shelves') || [];
            ['A','B','C','D','E'].forEach(row => {
                for(let i = 1; i <= 20; i++) {
                    shelves.push({
                        id: PodoDB.generateId('SH'),
                        code: row + '-' + String(i).padStart(2, '0'),
                        branchId: newBranch.id,
                        ownerId: null,
                        type: i <= 10 ? 'small' : 'medium',
                        price: i <= 10 ? 20000 : 35000
                    });
                }
            });
            PodoDB.set('shelves', shelves);
            
            closeModal('addBranchModal');
            showToast('ì§€ì ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            renderSection('branches');
            ['branchNameInput', 'branchAddress'].forEach(id => document.getElementById(id).value = '');
        }

        // Owner detail functions
        let currentOwnerId = null;
        function openOwnerDetail(ownerId) {
            currentOwnerId = ownerId;
            const owners = PodoDB.get('owners') || [];
            const branches = PodoDB.get('branches') || [];
            const books = PodoDB.get('books') || [];
            const sales = PodoDB.get('sales') || [];
            const owner = owners.find(o => o.id === ownerId);
            if (!owner) return;
            
            const branch = branches.find(b => b.id === owner.branchId);
            const ownerBooks = books.filter(b => b.ownerId === ownerId);
            const ownerSales = sales.filter(s => s.ownerId === ownerId);
            const totalSales = ownerSales.reduce((sum, s) => sum + s.price, 0);
            
            document.getElementById('ownerDetailBody').innerHTML = `
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem">
                    <div style="background:var(--grape-50);padding:1rem;border-radius:10px;text-align:center">
                        <div style="font-size:0.8rem;color:var(--text-light)">ì´ íŒë§¤ì•¡</div>
                        <div style="font-size:1.5rem;font-weight:700;color:var(--grape-700)">${formatMoney(totalSales)}</div>
                    </div>
                    <div style="background:var(--grape-50);padding:1rem;border-radius:10px;text-align:center">
                        <div style="font-size:0.8rem;color:var(--text-light)">ë“±ë¡ ë„ì„œ</div>
                        <div style="font-size:1.5rem;font-weight:700;color:var(--grape-700)">${ownerBooks.length}ê¶Œ</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì´ë¦„</label><input type="text" class="form-input" id="editOwnerName" value="${owner.name}"></div>
                    <div class="form-group"><label class="form-label">ì—°ë½ì²˜</label><input type="text" class="form-input" id="editOwnerPhone" value="${owner.phone}"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì´ë©”ì¼</label><input type="text" class="form-input" id="editOwnerEmail" value="${owner.email || ''}"></div>
                    <div class="form-group"><label class="form-label">ì§€ì </label><select class="form-select" id="editOwnerBranch">${branches.filter(b=>b.status==='active').map(b => `<option value="${b.id}" ${b.id === owner.branchId ? 'selected' : ''}>${b.name}</option>`).join('')}</select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">ì„œê°€</label><input type="text" class="form-input" id="editOwnerShelves" value="${owner.shelves?.join(', ') || ''}"></div>
                    <div class="form-group"><label class="form-label">ìƒíƒœ</label><select class="form-select" id="editOwnerStatus"><option value="active" ${owner.status === 'active' ? 'selected' : ''}>í™œì„±</option><option value="inactive" ${owner.status === 'inactive' ? 'selected' : ''}>íœ´ë©´</option></select></div>
                </div>
                <div class="form-group"><label class="form-label">ì •ì‚°ê³„ì¢Œ</label><input type="text" class="form-input" id="editOwnerBank" value="${owner.bank || ''}"></div>
            `;
            openModal('ownerDetailModal');
        }

        function updateOwner() {
            if (!currentOwnerId) return;
            const owners = PodoDB.get('owners') || [];
            const idx = owners.findIndex(o => o.id === currentOwnerId);
            if (idx < 0) return;
            
            owners[idx].name = document.getElementById('editOwnerName').value;
            owners[idx].phone = document.getElementById('editOwnerPhone').value;
            owners[idx].email = document.getElementById('editOwnerEmail').value;
            owners[idx].branchId = document.getElementById('editOwnerBranch').value;
            owners[idx].shelves = document.getElementById('editOwnerShelves').value.split(',').map(s => s.trim()).filter(s => s);
            owners[idx].status = document.getElementById('editOwnerStatus').value;
            owners[idx].bank = document.getElementById('editOwnerBank').value;
            
            PodoDB.set('owners', owners);
            closeModal('ownerDetailModal');
            showToast('ì ì£¼ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            renderSection('owners');
        }

        function deleteOwner() {
            if (!currentOwnerId) return;
            if (!confirm('ì •ë§ ì´ ì ì£¼ë¥¼ ì‚­ì œí• ê¹Œìš”? ê´€ë ¨ ë„ì„œë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;
            
            let owners = PodoDB.get('owners') || [];
            let books = PodoDB.get('books') || [];
            
            owners = owners.filter(o => o.id !== currentOwnerId);
            books = books.filter(b => b.ownerId !== currentOwnerId);
            
            PodoDB.set('owners', owners);
            PodoDB.set('books', books);
            
            closeModal('ownerDetailModal');
            showToast('ì ì£¼ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            renderSection('owners');
        }

        function showToast(msg, type) {
            const t = document.getElementById('toast');
            t.className = 'toast show ' + type;
            t.innerHTML = (type === 'success' ? 'âœ“' : 'âŒ') + ' ' + msg;
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawSalesChart() {
            const canvas = document.getElementById('salesChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const data = getSalesChartData(7);
            
            const width = canvas.width = canvas.offsetWidth * 2;
            const height = canvas.height = canvas.offsetHeight * 2;
            ctx.scale(2, 2);
            
            const padding = { top: 20, right: 20, bottom: 40, left: 60 };
            const chartWidth = width/2 - padding.left - padding.right;
            const chartHeight = height/2 - padding.top - padding.bottom;
            
            const maxAmount = Math.max(...data.map(d => d.amount), 10000);
            
            // ë°°ê²½
            ctx.fillStyle = '#fafafa';
            ctx.fillRect(0, 0, width/2, height/2);
            
            // ê·¸ë¦¬ë“œ
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = padding.top + (chartHeight / 4) * i;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(width/2 - padding.right, y);
                ctx.stroke();
                
                // Yì¶• ë ˆì´ë¸”
                ctx.fillStyle = '#666';
                ctx.font = '10px Pretendard';
                ctx.textAlign = 'right';
                const val = maxAmount - (maxAmount / 4) * i;
                ctx.fillText(formatMoney(val).replace('â‚©',''), padding.left - 5, y + 3);
            }
            
            // ë§‰ëŒ€ ê·¸ë˜í”„
            const barWidth = chartWidth / data.length * 0.6;
            const gap = chartWidth / data.length * 0.4;
            
            data.forEach((d, i) => {
                const x = padding.left + (chartWidth / data.length) * i + gap/2;
                const barHeight = (d.amount / maxAmount) * chartHeight;
                const y = padding.top + chartHeight - barHeight;
                
                // ë§‰ëŒ€
                const gradient = ctx.createLinearGradient(x, y, x, y + barHeight);
                gradient.addColorStop(0, '#7c4dff');
                gradient.addColorStop(1, '#9d7ae8');
                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Xì¶• ë ˆì´ë¸”
                ctx.fillStyle = '#666';
                ctx.font = '10px Pretendard';
                ctx.textAlign = 'center';
                ctx.fillText(d.label, x + barWidth/2, height/2 - padding.bottom + 15);
                
                // ê¸ˆì•¡ í‘œì‹œ
                if (d.amount > 0) {
                    ctx.fillStyle = '#333';
                    ctx.font = 'bold 9px Pretendard';
                    ctx.fillText(formatMoney(d.amount).replace('â‚©',''), x + barWidth/2, y - 5);
                }
            });
        }

        // ì•Œë¦¼ ê´€ë ¨
        function updateNotifCount() {
            const count = PodoNotification.getUnreadCount('admin');
            const badge = document.getElementById('notifCount');
            if (badge) {
                badge.textContent = count;
                badge.style.display = count > 0 ? 'flex' : 'none';
            }
        }

        function openNotifModal() {
            const notifs = PodoNotification.getForUser('admin', null, 20);
            document.getElementById('notifList').innerHTML = notifs.length === 0 
                ? '<p style="text-align:center;color:var(--text-light);padding:2rem">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</p>'
                : notifs.map(n => `
                    <div style="padding:1rem;border-bottom:1px solid #f0f0f0;${n.read ? 'opacity:0.6' : ''}">
                        <div style="display:flex;justify-content:space-between;margin-bottom:0.25rem">
                            <span style="font-weight:${n.read ? '400' : '600'}">${getNotifIcon(n.type)} ${n.message}</span>
                        </div>
                        <small style="color:var(--text-light)">${formatDateTime(n.createdAt)}</small>
                    </div>
                `).join('');
            openModal('notifModal');
        }

        function getNotifIcon(type) {
            const icons = { sale: 'ğŸ’°', settlement: 'ğŸ§¾', owner: 'ğŸ‘¤', book: 'ğŸ“š', system: 'âš™ï¸' };
            return icons[type] || 'ğŸ””';
        }

        function markAllNotifRead() {
            PodoNotification.markAllRead('admin');
            updateNotifCount();
            closeModal('notifModal');
            showToast('ëª¨ë“  ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤', 'success');
        }

        // ë°”ì½”ë“œ ìŠ¤ìºë„ˆ
        async function startScanner(inputId, onDetect) {
            const video = document.getElementById('scannerVideo') || document.getElementById('saleVideo');
            if (!video) return;
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                video.srcObject = stream;
                video.style.display = 'block';
                video.play();
                
                if (document.getElementById('scannerPlaceholder')) {
                    document.getElementById('scannerPlaceholder').style.display = 'none';
                }
                
                // BarcodeDetector API
                if ('BarcodeDetector' in window) {
                    const detector = new BarcodeDetector({ formats: ['ean_13', 'ean_8', 'code_128', 'qr_code'] });
                    const scan = async () => {
                        if (!video.srcObject) return;
                        try {
                            const barcodes = await detector.detect(video);
                            if (barcodes.length > 0) {
                                const code = barcodes[0].rawValue;
                                document.getElementById(inputId).value = code;
                                stopBarcodeScanner();
                                showToast('ìŠ¤ìº” ì™„ë£Œ: ' + code, 'success');
                                if (onDetect) onDetect();
                                return;
                            }
                        } catch(e) {}
                        if (video.srcObject) requestAnimationFrame(scan);
                    };
                    scan();
                } else {
                    showToast('ì´ ë¸Œë¼ìš°ì €ëŠ” ë°”ì½”ë“œ ìŠ¤ìº”ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìˆ˜ë™ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                }
            } catch (err) {
                showToast('ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
            }
        }

        function stopBarcodeScanner() {
            const videos = document.querySelectorAll('video');
            videos.forEach(video => {
                if (video.srcObject) {
                    video.srcObject.getTracks().forEach(t => t.stop());
                    video.srcObject = null;
                    video.style.display = 'none';
                }
            });
            if (document.getElementById('scannerPlaceholder')) {
                document.getElementById('scannerPlaceholder').style.display = 'block';
            }
        }

        // ë°˜í’ˆ ì²˜ë¦¬
        function refundSale(saleId) {
            if (!confirm('ì •ë§ ë°˜í’ˆ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì¬ê³ ê°€ ë³µêµ¬ë˜ê³  ì ì£¼ ì ë¦½ê¸ˆì´ ì°¨ê°ë©ë‹ˆë‹¤.')) return;
            const result = processRefund(saleId);
            if (result) {
                showToast('ë°˜í’ˆ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                renderSection(currentSection);
            } else {
                showToast('ë°˜í’ˆ ì²˜ë¦¬ ì‹¤íŒ¨', 'error');
            }
        }

        // QRì½”ë“œ ë¼ë²¨ ì¶œë ¥
        function printQRLabel(item) {
            const qrData = encodeURIComponent(JSON.stringify({ id: item.id, ownerNumber: item.ownerNumber, price: item.price }));
            const qrImageUrl = `https://chart.googleapis.com/chart?chs=100x100&cht=qr&chl=${qrData}&choe=UTF-8`;
            
            const printWindow = window.open('', '_blank', 'width=300,height=400');
            printWindow.document.write(`
                <html>
                <head><title>QR ë¼ë²¨ ì¶œë ¥</title>
                <style>body{margin:0;padding:10mm;font-family:sans-serif}
                .label{width:50mm;padding:3mm;border:1px solid #000;text-align:center}
                .title{font-size:12px;font-weight:bold;margin-bottom:2mm;max-height:16px;overflow:hidden}
                .owner{font-size:10px;color:#666;margin-bottom:3mm}
                .qr{width:20mm;height:20mm;margin:0 auto 2mm}
                .price{font-size:16px;font-weight:bold}</style>
                </head>
                <body>
                <div class="label">
                    <div class="title">${item.title || item.name}</div>
                    <div class="owner">${item.ownerNumber || 'í¬ë„ì±…ë°©'}</div>
                    <img src="${qrImageUrl}" class="qr">
                    <div class="price">â‚©${item.price.toLocaleString()}</div>
                </div>
                <script>window.onload=function(){window.print();}<\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // ë³¸ì‚¬ íŒë§¤ë‚´ì—­ ê¸°ê°„/ì§€ì  í•„í„°
        function filterAdminSales() {
            const startDate = document.getElementById('adminSalesStart')?.value;
            const endDate = document.getElementById('adminSalesEnd')?.value;
            const branchFilter = document.getElementById('adminSalesBranch')?.value;
            const rows = document.querySelectorAll('#adminSalesTable tbody tr');
            let total = 0, count = 0;
            
            rows.forEach(row => {
                const date = row.dataset.date;
                const branch = row.dataset.branch;
                let show = true;
                if (startDate && date < startDate) show = false;
                if (endDate && date > endDate) show = false;
                if (branchFilter && branch !== branchFilter) show = false;
                row.style.display = show ? '' : 'none';
                if (show) {
                    count++;
                    const priceCell = row.cells[5]; // ê¸ˆì•¡ ì»¬ëŸ¼
                    if (priceCell) {
                        const price = parseInt(priceCell.textContent.replace(/[â‚©,]/g, '')) || 0;
                        total += price;
                    }
                }
            });
            
            const summary = document.getElementById('adminSalesSummary');
            if (summary) summary.textContent = `ì´ ${count}ê±´ / ${formatMoney(total)}`;
        }
        
        function resetAdminSalesFilter() {
            const startEl = document.getElementById('adminSalesStart');
            const endEl = document.getElementById('adminSalesEnd');
            const branchEl = document.getElementById('adminSalesBranch');
            if (startEl) startEl.value = '';
            if (endEl) endEl.value = '';
            if (branchEl) branchEl.value = '';
            filterAdminSales();
        }
    </script>
</body>
</html>
